# 'make flash' uses the programmer to load it onto the target chip.
# 'make fuses' programs the fuse bits on the target chip.
# 'make clean' removes all autogenerated files.

# Set up the application
APPLICATION = bootloader

# Set up which MCU you're using, and what programmer, and the clock speed
# here.
MCU = ATmega32U4
PROGRAMMER ?= tigard
CONFIGURATION_FILE = +tigard.conf
F_CPU = 8000000UL

# Fuse bit` settings
EFUSE=0xCE
HFUSE=0xD8
LFUSE=0xFF

AVRDUDE = avrdude

# Compiler and linker flags

all: $(APPLICATION).hex

clean:
	rm -f usbdrv/*.o
	rm -f *.hex *.elf *.o 

flash: 
	$(AVRDUDE) -p $(MCU) -C $(CONFIGURATION_FILE) -c $(PROGRAMMER) -P usb -e \
		-U flash:w:$(APPLICATION).hex

fuses:
	$(AVRDUDE) -p $(MCU) -C $(CONFIGURATION_FILE) -c $(PROGRAMMER) -P usb \
		-U lfuse:w:$(LFUSE):m -U hfuse:w:$(HFUSE):m \
		-U efuse:w:$(EFUSE):m


.PHONY: all clean install fuses
